version: '3.5'
services:
  gogen-filebeat:
    build:
      context: gogen-filebeat
    volumes:
    #  - "/var/lib/docker/containers:/usr/share/dockerlogs/data:ro"
    #  - "/var/run/docker.sock:/var/run/docker.sock"
      - "${DOCKER_LIB_CONTAINERS:-/var/lib/docker/containers}:/var/lib/docker/containers"
      - "/var/run/docker.sock:/var/run/docker.sock"
  cribl:
    build:
      context: cribl
    ports:
      - "10080:10080"
      - "10001:10001"
      - "9000:9000"
    volumes:
      - "./cribl/cribl:/opt/cribl/local/cribl"
  splunk:
    build:
      context: splunk
    ports:
      - "8000:8000"
      - "8088:8088"
      - "8089:8089"
      - "9997:9997"
    environment:
      - "DONT_TIMEOUT=1"
      - "CRIBL_ROUTING_DEMO=1"
  minio:
    image: minio/minio:latest
    environment:
      - "MINIO_ACCESS_KEY=ACCESSKEY"
      - "MINIO_SECRET_KEY=SECRETKEY"
    ports:
      - "9001:9000"
    volumes:
      - "./data/minio:/data"
    command: server /data

  elasticsearch:
    build:
      context: elasticsearch/
      args:
        ELK_VERSION: $ELK_VERSION
    volumes:
      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      ES_JAVA_OPTS: "-Xmx256m -Xms256m"

  kibana:
    build:
      context: kibana
      args:
        ELK_VERSION: $ELK_VERSION
    volumes:
      - ./kibana/config/:/usr/share/kibana/config:ro
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch


